<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>QRLOGIX - Sistema Inteligente de Inventario</title>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            min-height: 100vh;
            padding: 10px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            background: linear-gradient(to right, #fff, #a0d2eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .logo {
            font-weight: 800;
            font-size: 2.5rem;
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            max-width: 90%;
            margin: 0 auto;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .app-container {
                grid-template-columns: 1fr 1fr;
            }
            
            body {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.8rem;
            }
        }

        .scanner-section, .inventory-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .section-title {
            font-size: 1.3rem;
            color: #1a2a6c;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #1a2a6c;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (min-width: 768px) {
            .section-title {
                font-size: 1.5rem;
            }
        }

        .camera-container {
            position: relative;
            width: 100%;
            height: 250px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            background: #000;
            border: 2px solid #1a2a6c;
        }

        @media (min-width: 768px) {
            .camera-container {
                height: 300px;
            }
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        .scan-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 3px solid #1a2a6c;
            border-radius: 15px;
            box-shadow: 0 0 0 1000px rgba(0,0,0,0.5);
        }

        @media (min-width: 768px) {
            .scan-overlay {
                width: 250px;
                height: 250px;
            }
        }

        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: #1a2a6c;
            animation: scan 2s infinite linear;
            box-shadow: 0 0 10px #1a2a6c;
        }

        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(200px); }
        }

        @media (min-width: 768px) {
            @keyframes scan {
                0% { transform: translateY(0); }
                100% { transform: translateY(250px); }
            }
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        @media (min-width: 768px) {
            .controls {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        button {
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        @media (min-width: 768px) {
            button {
                padding: 12px 20px;
                font-size: 1rem;
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #b21f1f, #1a2a6c);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #ff6b6b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #4da0ff);
            color: white;
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }

        .result-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid #1a2a6c;
        }

        .result-title {
            font-weight: 600;
            color: #1a2a6c;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .result-content {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid #1a2a6c;
            word-break: break-all;
            min-height: 50px;
            display: flex;
            align-items: center;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .product-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .info-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .info-label {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .info-value {
            font-weight: 700;
            color: #1a2a6c;
            font-size: 0.95rem;
        }

        .inventory-list {
            max-height: 350px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .inventory-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 3px solid #1a2a6c;
            transition: transform 0.2s ease;
        }

        .inventory-item:hover {
            transform: translateX(3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .item-name {
            font-weight: 700;
            color: #1a2a6c;
            font-size: 1rem;
            flex: 1;
        }

        .item-quantity {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .item-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            font-size: 0.85rem;
            color: #555;
        }

        @media (min-width: 768px) {
            .item-details {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .status-item {
            text-align: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1a2a6c;
            margin: 8px 0;
        }

        .status-label {
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
        }

        .auto-integration {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .notification {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            font-size: 0.9rem;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc3545, #ff6b6b);
        }

        .notification.info {
            background: linear-gradient(135deg, #17a2b8, #4da0ff);
        }

        .scan-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #dc3545;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .scan-success {
            background: #28a745;
        }

        .fps-counter {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .qr-highlight {
            position: absolute;
            border: 2px solid #28a745;
            background: rgba(40, 167, 69, 0.2);
            pointer-events: none;
        }

        .report-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            margin-top: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .report-title {
            font-size: 1.5rem;
            color: #1a2a6c;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 700;
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .report-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-top: 3px solid #1a2a6c;
        }

        .report-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1a2a6c;
            margin: 8px 0;
        }

        .report-label {
            color: #666;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .share-section {
            text-align: center;
            margin-top: 20px;
        }

        .share-title {
            font-size: 1.2rem;
            color: #1a2a6c;
            margin-bottom: 15px;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .share-button {
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }

        .footer {
            text-align: center;
            color: white;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.8rem;
        }

        .system-status {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #28a745;
        }

        .status-dot.offline {
            background: #dc3545;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1a2a6c;
        }

        .qr-container {
            text-align: center;
            margin: 15px 0;
        }

        .qr-code-display {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            background: white;
            padding: 8px;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .qr-code-display {
                width: 150px;
                height: 150px;
            }
        }

        .download-section {
            margin-top: 12px;
        }

        .actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .actions button {
            flex: 1;
            min-width: 80px;
            padding: 8px 10px;
            font-size: 0.8rem;
        }

        .low-stock {
            color: #dc3545;
            font-weight: bold;
        }

        .medium-stock {
            color: #ffc107;
            font-weight: bold;
        }

        .good-stock {
            color: #28a745;
            font-weight: bold;
        }

        .search-filters {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        @media (min-width: 768px) {
            .search-filters {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        .search-filters input, .search-filters select {
            width: 100%;
            padding: 10px;
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 15px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        @media (min-width: 768px) {
            .modal-content {
                padding: 20px;
                width: 80%;
                max-width: 600px;
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            margin-top: -5px;
        }

        .close:hover {
            color: black;
        }

        .camera-error {
            color: white;
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .camera-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .camera-control-btn {
            padding: 8px;
            font-size: 0.85rem;
        }

        .compatibility-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .mobile-optimized {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 42, 108, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 100;
            display: none;
        }

        @media (max-width: 767px) {
            .mobile-optimized {
                display: block;
            }
        }

        .scan-hint {
            text-align: center;
            color: white;
            margin: 10px 0;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .product-image {
            width: 100%;
            height: 150px;
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="logo">QRLOGIX</h1>
            <p class="subtitle">Sistema Inteligente de Gesti√≥n de Inventario con IA y Sincronizaci√≥n en Tiempo Real</p>
        </header>

        <div class="system-status">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>Sistema Activo</span>
            </div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>IA Conectada</span>
            </div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>Google Sheets Online</span>
            </div>
        </div>

        <div class="compatibility-warning" id="compatibilityWarning" style="display: none;">
            ‚ö†Ô∏è Tu navegador puede tener limitaciones para acceder a la c√°mara. Para una mejor experiencia, usa Chrome, Firefox o Edge en un dispositivo con c√°mara.
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-value" id="totalProducts">0</div>
                <div class="status-label">Productos Totales</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="scannedToday">0</div>
                <div class="status-label">Escaneados Hoy</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="cameraStatus">üî¥</div>
                <div class="status-label">C√°mara</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="scanStatus">‚è∏</div>
                <div class="status-label">Escaneo</div>
            </div>
        </div>

        <div class="app-container">
            <div class="scanner-section">
                <h2 class="section-title">üì∑ Esc√°ner QR en Tiempo Real</h2>
                
                <div class="camera-controls">
                    <button id="switchCamera" class="btn-info camera-control-btn">üîÑ Cambiar C√°mara</button>
                    <button id="toggleFlash" class="btn-warning camera-control-btn">üí° Flash</button>
                </div>
                
                <div class="camera-container">
                    <video id="video" autoplay playsinline></video>
                    <div class="scan-overlay">
                        <div class="scan-line"></div>
                    </div>
                    <div class="scan-indicator" id="scanIndicator"></div>
                    <div class="fps-counter" id="fpsCounter">FPS: 0</div>
                </div>

                <div class="scan-hint">
                    üì± Apunta la c√°mara hacia un c√≥digo QR para escanear
                </div>

                <div class="controls">
                    <button id="startScan" class="btn-primary">‚ñ∂ Iniciar</button>
                    <button id="stopScan" class="btn-secondary">‚èπ Detener</button>
                    <button id="generateReport" class="btn-success">üìä Reporte</button>
                </div>

                <div class="result-container">
                    <div class="result-title">Resultado del Escaneo:</div>
                    <div class="result-content" id="scanResult">
                        Esperando escaneo...
                    </div>
                    
                    <div class="product-info" id="productInfo" style="display: none;">
                        <div class="info-item">
                            <div class="info-label">Tipo</div>
                            <div class="info-value" id="productType">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Nombre</div>
                            <div class="info-value" id="productName">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Categor√≠a</div>
                            <div class="info-value" id="productCategory">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Precio</div>
                            <div class="info-value" id="productPrice">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="inventory-section">
                <h2 class="section-title">üì¶ Inventario en Tiempo Real</h2>
                
                <div class="search-filters">
                    <input type="text" id="searchInput" placeholder="Buscar productos...">
                    <select id="filterCategory">
                        <option value="">Todas las categor√≠as</option>
                        <option value="electronica">Electr√≥nica</option>
                        <option value="ropa">Ropa</option>
                        <option value="alimentos">Alimentos</option>
                        <option value="hogar">Hogar</option>
                        <option value="deportes">Deportes</option>
                        <option value="libros">Libros</option>
                    </select>
                    <select id="filterStock">
                        <option value="">Todos los stocks</option>
                        <option value="bajo">Bajo stock (&lt; 10)</option>
                        <option value="medio">Medio stock (10-50)</option>
                        <option value="alto">Alto stock (&gt; 50)</option>
                    </select>
                </div>

                <div class="controls">
                    <button id="addProduct" class="btn-primary">‚ûï Agregar</button>
                    <button id="refreshInventory" class="btn-primary">‚Üª Actualizar</button>
                    <button id="exportPDF" class="btn-success">üìÑ PDF</button>
                    <button id="shareWhatsApp" class="btn-whatsapp">üì± WhatsApp</button>
                </div>

                <div class="inventory-list" id="inventoryList">
                    <div class="inventory-item">
                        <div class="item-header">
                            <div class="item-name">No hay productos registrados</div>
                        </div>
                        <div class="item-details">
                            <div>Escanea c√≥digos QR para comenzar</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="auto-integration">
            ‚úÖ Integraci√≥n Autom√°tica Activada - An√°lisis IA + Sincronizaci√≥n Google Sheets en Tiempo Real
        </div>

        <div class="report-section">
            <h2 class="report-title">üìä Reportes Autom√°ticos QRLOGIX</h2>
            
            <div class="report-grid">
                <div class="report-card">
                    <div class="report-value" id="weeklyScans">0</div>
                    <div class="report-label">Escaneos Semanales</div>
                </div>
                <div class="report-card">
                    <div class="report-value" id="uniqueProducts">0</div>
                    <div class="report-label">Productos √önicos</div>
                </div>
                <div class="report-card">
                    <div class="report-value" id="totalValue">$0</div>
                    <div class="report-label">Valor Total</div>
                </div>
                <div class="report-card">
                    <div class="report-value" id="nextReport">24h</div>
                    <div class="report-label">Pr√≥ximo Reporte</div>
                </div>
            </div>

            <div class="share-section">
                <h3 class="share-title">üì§ Compartir Reporte</h3>
                <div class="share-buttons">
                    <button class="share-button btn-whatsapp" id="shareReportWhatsApp">
                        üì± WhatsApp
                    </button>
                    <button class="share-button btn-primary">
                        üìß Email
                    </button>
                    <button class="share-button btn-info">
                        üí¨ Teams
                    </button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>QRLOGIX - Sistema Inteligente de Gesti√≥n de Inventario ¬© 2023</p>
            <p>Integraci√≥n Autom√°tica con IA y Google Sheets - Reportes Semanales Autom√°ticos</p>
        </div>

        <div class="mobile-optimized" id="mobileScanBtn">
            üì± Escanear QR
        </div>
    </div>

    <!-- Modal para agregar/editar producto -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Registrar/Editar Producto QR</h2>
            <form id="productForm">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label for="nombre_producto">Nombre del Producto *</label>
                    <input type="text" id="nombre_producto" placeholder="Ingrese nombre del producto" required>
                </div>
                <div class="form-group">
                    <label for="descripcion">Descripci√≥n</label>
                    <textarea id="descripcion" placeholder="Descripci√≥n del producto"></textarea>
                </div>
                <div class="form-group">
                    <label for="precio">Precio ($)</label>
                    <input type="number" id="precio" step="0.01" min="0" placeholder="0.00" required>
                </div>
                <div class="form-group">
                    <label for="cantidad">Cantidad Disponible</label>
                    <input type="number" id="cantidad" min="0" placeholder="0" required>
                </div>
                <div class="form-group">
                    <label for="categoria">Categor√≠a</label>
                    <select id="categoria" required>
                        <option value="">Seleccione categor√≠a</option>
                        <option value="electronica">Electr√≥nica</option>
                        <option value="ropa">Ropa</option>
                        <option value="alimentos">Alimentos</option>
                        <option value="hogar">Hogar</option>
                        <option value="deportes">Deportes</option>
                        <option value="libros">Libros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="codigo_interno">C√≥digo Interno</label>
                    <input type="text" id="codigo_interno" placeholder="C√≥digo √∫nico interno">
                </div>
                <div class="form-group">
                    <label for="estado">Estado</label>
                    <select id="estado" required>
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                        <option value="agotado">Agotado</option>
                    </select>
                </div>
                <div class="controls">
                    <button type="submit" class="btn-success" id="submitBtn">Registrar Producto QR</button>
                    <button type="button" class="btn-warning" id="cancelBtn">Cancelar</button>
                </div>
            </form>
            <div class="qr-container">
                <h3>C√≥digo QR Generado</h3>
                <div class="qr-code-display" id="qrDisplay">
                    <div style="color: #666;">QR Pendiente</div>
                </div>
                <div class="download-section">
                    <button class="btn-info" id="downloadBtn">Descargar QR</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para mostrar detalles del producto -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Detalles del Producto</h2>
            <div id="modalContent"></div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <div id="reportContent" style="display: none;">
        <h1>Reporte de Inventario QRLOGIX</h1>
        <p>Fecha: <span id="reportDate"></span></p>
        <p>Total Productos: <span id="reportTotalProducts"></span></p>
        <p>Valor Total: <span id="reportTotalValue"></span></p>
        <div id="reportItems"></div>
    </div>

    <script>
        // Base de datos integrada
        let productsDatabase = [
            { id: 'QR001', nombre: 'Smartphone Samsung Galaxy S21', descripcion: 'Smartphone de √∫ltima generaci√≥n con pantalla AMOLED', precio: 799.99, cantidad: 25, categoria: 'electronica', codigo_interno: 'SAM-GAL-S21-BLK', estado: 'activo', fecha_creacion: '2023-10-15' },
            { id: 'QR002', nombre: 'Camiseta Algod√≥n Premium', descripcion: 'Camiseta 100% algod√≥n peinado', precio: 29.99, cantidad: 150, categoria: 'ropa', codigo_interno: 'CAM-PREM-WHT-M', estado: 'activo', fecha_creacion: '2023-10-18' },
            { id: 'QR003', nombre: 'Chocolate Artesanal 85% Cacao', descripcion: 'Chocolate oscuro artesanal premium', precio: 8.50, cantidad: 3, categoria: 'alimentos', codigo_interno: 'CHOC-ART-DARK-85', estado: 'agotado', fecha_creacion: '2023-10-20' },
            { id: 'QR004', nombre: 'Aspiradora Robot Inteligente', descripcion: 'Aspiradora robot con mapeo inteligente', precio: 299.99, cantidad: 8, categoria: 'hogar', codigo_interno: 'ASP-ROB-INT-V2', estado: 'activo', fecha_creacion: '2023-10-22' },
            { id: 'QR005', nombre: 'Zapatillas Running Nike Air', descripcion: 'Zapatillas para running con tecnolog√≠a Air', precio: 129.99, cantidad: 42, categoria: 'deportes', codigo_interno: 'ZAP-RUN-NKE-AIR', estado: 'activo', fecha_creacion: '2023-10-25' }
        ];

        class QRLOGIXSystem {
            constructor() {
                this.video = document.getElementById('video');
                this.scanResult = document.getElementById('scanResult');
                this.productInfo = document.getElementById('productInfo');
                this.inventoryList = document.getElementById('inventoryList');
                this.notification = document.getElementById('notification');
                this.scanIndicator = document.getElementById('scanIndicator');
                this.fpsCounter = document.getElementById('fpsCounter');
                this.stream = null;
                this.scanning = false;
                this.scanInterval = null;
                this.inventory = [...productsDatabase];
                this.scannedToday = 0;
                this.lastScanTime = 0;
                this.canvas = document.createElement('canvas');
                this.canvasContext = null;
                this.frameCount = 0;
                this.lastFpsUpdate = 0;
                this.qrHighlights = [];
                this.reportInterval = null;
                this.currentQRCode = null;
                this.qrInstance = null;
                this.devices = [];
                this.currentDeviceIndex = 0;
                this.flashOn = false;
                this.isMobile = this.detectMobile();
                this.checkCompatibility();
                this.initCamera();
                this.bindEvents();
                this.updateStats();
                this.startAutoReport();
                this.renderInventory();
                this.setupMobileOptimization();
            }

            detectMobile() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }

            setupMobileOptimization() {
                if (this.isMobile) {
                    const mobileBtn = document.getElementById('mobileScanBtn');
                    mobileBtn.style.display = 'block';
                    mobileBtn.addEventListener('click', () => {
                        this.scrollToScanner();
                    });
                }
            }

            scrollToScanner() {
                document.querySelector('.scanner-section').scrollIntoView({
                    behavior: 'smooth'
                });
            }

            checkCompatibility() {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    document.getElementById('compatibilityWarning').style.display = 'block';
                    this.showNotification('Tu navegador no soporta acceso a la c√°mara. Usa Chrome, Firefox o Edge.', 'error');
                }
            }

            async initCamera() {
                try {
                    // Obtener dispositivos de v√≠deo disponibles
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    this.devices = devices.filter(device => device.kind === 'videoinput');

                    // Configurar restricciones de c√°mara optimizadas para m√≥vil
                    const constraints = {
                        video: {
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 },
                            focusMode: 'continuous',
                            exposureMode: 'continuous'
                        }
                    };

                    // Si hay m√∫ltiples c√°maras, usar la primera trasera
                    if (this.devices.length > 1) {
                        constraints.video.deviceId = { exact: this.devices[1].deviceId };
                    }

                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.video.srcObject = this.stream;

                    this.video.onloadedmetadata = () => {
                        document.getElementById('cameraStatus').textContent = 'üü¢';
                        this.showNotification('C√°mara QRLOGIX activada', 'success');
                        this.canvas.width = this.video.videoWidth;
                        this.canvas.height = this.video.videoHeight;
                        this.canvasContext = this.canvas.getContext('2d');
                        setTimeout(() => {
                            this.startScanning();
                        }, 1000);
                    };
                } catch (error) {
                    console.error('Error c√°mara:', error);
                    this.showNotification('Error c√°mara: ' + error.message, 'error');
                    document.getElementById('cameraStatus').textContent = 'üî¥';

                    // Mostrar mensaje de error en la interfaz
                    const cameraContainer = document.querySelector('.camera-container');
                    cameraContainer.innerHTML = `
                        <div class="camera-error">
                            <h3>‚ö†Ô∏è Error al acceder a la c√°mara</h3>
                            <p>${error.message}</p>
                            <p>Por favor, verifica los permisos de la c√°mara y recarga la p√°gina.</p>
                        </div>
                    `;
                }
            }

            async switchCamera() {
                if (this.devices.length <= 1) {
                    this.showNotification('Solo hay una c√°mara disponible', 'info');
                    return;
                }

                this.stopScanning();
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                }

                this.currentDeviceIndex = (this.currentDeviceIndex + 1) % this.devices.length;

                try {
                    const constraints = {
                        video: {
                            deviceId: { exact: this.devices[this.currentDeviceIndex].deviceId },
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    };

                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.video.srcObject = this.stream;

                    this.video.onloadedmetadata = () => {
                        this.canvas.width = this.video.videoWidth;
                        this.canvas.height = this.video.videoHeight;
                        this.canvasContext = this.canvas.getContext('2d');
                        this.startScanning();
                        this.showNotification('C√°mara cambiada', 'success');
                    };
                } catch (error) {
                    this.showNotification('Error al cambiar c√°mara: ' + error.message, 'error');
                }
            }

            async toggleFlash() {
                if (!this.stream) return;

                try {
                    const track = this.stream.getVideoTracks()[0];
                    const capabilities = track.getCapabilities();

                    if ('torch' in capabilities) {
                        this.flashOn = !this.flashOn;
                        await track.applyConstraints({
                            advanced: [{ torch: this.flashOn }]
                        });

                        document.getElementById('toggleFlash').textContent = this.flashOn ? 'üí° Flash ON' : 'üí° Flash';
                        this.showNotification(`Flash ${this.flashOn ? 'activado' : 'desactivado'}`, 'info');
                    } else {
                        this.showNotification('Flash no disponible en esta c√°mara', 'error');
                    }
                } catch (error) {
                    this.showNotification('Error flash: ' + error.message, 'error');
                }
            }

            bindEvents() {
                // Botones principales
                document.getElementById('startScan').addEventListener('click', () => this.startScanning());
                document.getElementById('stopScan').addEventListener('click', () => this.stopScanning());
                document.getElementById('refreshInventory').addEventListener('click', () => this.refreshInventory());
                document.getElementById('exportPDF').addEventListener('click', () => this.exportPDF());
                document.getElementById('generateReport').addEventListener('click', () => this.generateWeeklyReport());
                document.getElementById('shareWhatsApp').addEventListener('click', () => this.shareWhatsApp());
                document.getElementById('shareReportWhatsApp').addEventListener('click', () => this.shareReportWhatsApp());
                document.getElementById('addProduct').addEventListener('click', () => this.openAddProductModal());
                document.getElementById('switchCamera').addEventListener('click', () => this.switchCamera());
                document.getElementById('toggleFlash').addEventListener('click', () => this.toggleFlash());

                // Formulario de producto
                document.getElementById('productForm').addEventListener('submit', (e) => this.handleProductFormSubmit(e));
                document.getElementById('cancelBtn').addEventListener('click', () => this.closeProductModal());
                document.getElementById('downloadBtn').addEventListener('click', () => this.downloadQRCode());

                // B√∫squeda y filtros
                document.getElementById('searchInput').addEventListener('input', () => this.filterProducts());
                document.getElementById('filterCategory').addEventListener('change', () => this.filterProducts());
                document.getElementById('filterStock').addEventListener('change', () => this.filterProducts());

                // Modales
                document.querySelectorAll('.close').forEach(closeBtn => {
                    closeBtn.addEventListener('click', () => {
                        document.getElementById('productModal').style.display = 'none';
                        document.getElementById('detailsModal').style.display = 'none';
                    });
                });

                window.addEventListener('click', (event) => {
                    if (event.target.id === 'productModal') {
                        document.getElementById('productModal').style.display = 'none';
                    }
                    if (event.target.id === 'detailsModal') {
                        document.getElementById('detailsModal').style.display = 'none';
                    }
                });

                // Optimizaci√≥n para m√≥vil
                if (this.isMobile) {
                    document.getElementById('mobileScanBtn').addEventListener('click', () => {
                        this.scrollToScanner();
                    });
                }
            }

            openAddProductModal() {
                document.getElementById('productForm').reset();
                document.getElementById('editId').value = '';
                document.getElementById('submitBtn').textContent = 'Registrar Producto QR';
                document.getElementById('qrDisplay').innerHTML = '<div style="color: #666;">QR Pendiente</div>';
                this.currentQRCode = null;
                document.getElementById('productModal').style.display = 'block';
            }

            startScanning() {
                if (!this.stream) {
                    this.showNotification('C√°mara no disponible', 'error');
                    return;
                }

                this.scanning = true;
                document.getElementById('scanStatus').textContent = '‚ñ∂';
                this.showNotification('Escaneo QRLOGIX iniciado', 'info');

                this.scanInterval = setInterval(() => {
                    if (this.scanning) {
                        this.processFrame();
                    }
                }, 30);
            }

            stopScanning() {
                this.scanning = false;
                if (this.scanInterval) {
                    clearInterval(this.scanInterval);
                    this.scanInterval = null;
                }
                document.getElementById('scanStatus').textContent = '‚è∏';
                this.clearHighlights();
                this.showNotification('Escaneo detenido', 'info');
            }

            processFrame() {
                if (this.video.readyState === this.video.HAVE_ENOUGH_DATA && this.canvasContext) {
                    this.updateFps();
                    this.canvasContext.drawImage(this.video, 0, 0, this.canvas.width, this.canvas.height);
                    const imageData = this.canvasContext.getImageData(0, 0, this.canvas.width, this.canvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: "attemptBoth"
                    });

                    if (code) {
                        this.handleQRCode(code.data);
                        this.highlightQR(code.location);
                        this.scanIndicator.classList.add('scan-success');
                        setTimeout(() => {
                            this.scanIndicator.classList.remove('scan-success');
                        }, 500);
                    } else {
                        this.scanIndicator.classList.remove('scan-success');
                        this.clearHighlights();
                    }
                }
            }

            highlightQR(location) {
                this.clearHighlights();
                const highlight = document.createElement('div');
                highlight.className = 'qr-highlight';

                const container = document.querySelector('.camera-container');
                const scaleX = container.offsetWidth / this.canvas.width;
                const scaleY = container.offsetHeight / this.canvas.height;

                const minX = Math.min(
                    location.topLeftCorner.x,
                    location.topRightCorner.x,
                    location.bottomLeftCorner.x,
                    location.bottomRightCorner.x
                );
                const minY = Math.min(
                    location.topLeftCorner.y,
                    location.topRightCorner.y,
                    location.bottomLeftCorner.y,
                    location.bottomRightCorner.y
                );
                const maxX = Math.max(
                    location.topLeftCorner.x,
                    location.topRightCorner.x,
                    location.bottomLeftCorner.x,
                    location.bottomRightCorner.x
                );
                const maxY = Math.max(
                    location.topLeftCorner.y,
                    location.topRightCorner.y,
                    location.bottomLeftCorner.y,
                    location.bottomRightCorner.y
                );

                highlight.style.left = (minX * scaleX) + 'px';
                highlight.style.top = (minY * scaleY) + 'px';
                highlight.style.width = ((maxX - minX) * scaleX) + 'px';
                highlight.style.height = ((maxY - minY) * scaleY) + 'px';

                container.appendChild(highlight);
                this.qrHighlights.push(highlight);
            }

            clearHighlights() {
                this.qrHighlights.forEach(highlight => {
                    if (highlight.parentNode) {
                        highlight.parentNode.removeChild(highlight);
                    }
                });
                this.qrHighlights = [];
            }

            updateFps() {
                this.frameCount++;
                const now = performance.now();
                if (now - this.lastFpsUpdate >= 1000) {
                    const fps = Math.round((this.frameCount * 1000) / (now - this.lastFpsUpdate));
                    this.fpsCounter.textContent = `FPS: ${fps}`;
                    this.frameCount = 0;
                    this.lastFpsUpdate = now;
                }
            }

            handleQRCode(data) {
                const currentTime = Date.now();
                if (currentTime - this.lastScanTime < 800) {
                    return;
                }

                this.lastScanTime = currentTime;
                this.scanResult.textContent = data;
                this.showNotification('C√≥digo QR detectado', 'success');
                this.stopScanning();

                // Buscar en la base de datos
                const product = this.inventory.find(p => p.id === data);
                if (product) {
                    this.displayProductInfoFromDB(product);
                    this.showNotification('Producto encontrado en la base de datos', 'success');
                } else {
                    this.showNotification('Producto no encontrado en la base de datos', 'error');
                }

                setTimeout(() => {
                    if (document.getElementById('scanStatus').textContent === '‚è∏') {
                        this.startScanning();
                    }
                }, 5000);
            }

            displayProductInfoFromDB(product) {
                document.getElementById('productType').textContent = this.getCategoriaText(product.categoria);
                document.getElementById('productName').textContent = product.nombre;
                document.getElementById('productCategory').textContent = this.getCategoriaText(product.categoria);
                document.getElementById('productPrice').textContent = `$${product.precio.toFixed(2)}`;
                
                this.productInfo.style.display = 'grid';
                this.scannedToday++;
                this.updateStats();
            }

            getCategoriaText(categoria) {
                const categorias = {
                    'electronica': 'Electr√≥nica',
                    'ropa': 'Ropa',
                    'alimentos': 'Alimentos',
                    'hogar': 'Hogar',
                    'deportes': 'Deportes',
                    'libros': 'Libros'
                };
                return categorias[categoria] || categoria;
            }

            getEstadoText(estado) {
                const estados = {
                    'activo': 'Activo',
                    'inactivo': 'Inactivo',
                    'agotado': 'Agotado'
                };
                return estados[estado] || estado;
            }

            getStockClass(cantidad) {
                if (cantidad < 10) return 'low-stock';
                if (cantidad < 50) return 'medium-stock';
                return 'good-stock';
            }

            generateNewId() {
                const maxId = Math.max(...this.inventory.map(item => parseInt(item.id.replace('QR', ''))), 0);
                return `QR${String(maxId + 1).padStart(3, '0')}`;
            }

            renderInventory(data = null) {
                const inventoryData = data || this.inventory;
                
                if (inventoryData.length === 0) {
                    this.inventoryList.innerHTML = `
                        <div class="inventory-item">
                            <div class="item-header">
                                <div class="item-name">No hay productos registrados</div>
                            </div>
                            <div class="item-details">
                                <div>Escanea c√≥digos QR para comenzar</div>
                            </div>
                        </div>
                    `;
                    return;
                }

                this.inventoryList.innerHTML = inventoryData.map(item => {
                    const stockClass = this.getStockClass(item.cantidad);
                    return `
                        <div class="inventory-item">
                            <div class="item-header">
                                <div class="item-name">${item.nombre}</div>
                                <div class="item-quantity ${stockClass}">${item.cantidad}</div>
                            </div>
                            <div class="item-details">
                                <div>ID: ${item.id}</div>
                                <div>Categor√≠a: ${this.getCategoriaText(item.categoria)}</div>
                                <div>Precio: $${item.precio.toFixed(2)}</div>
                                <div>Estado: ${this.getEstadoText(item.estado)}</div>
                            </div>
                            <div class="actions">
                                <button class="btn-info" onclick="app.viewProductDetails('${item.id}')">Ver</button>
                                <button class="btn-warning" onclick="app.editProduct('${item.id}')">Editar</button>
                                <button class="btn-danger" onclick="app.deleteProduct('${item.id}')">Eliminar</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            filterProducts() {
                let filteredData = [...this.inventory];

                // Filtro por b√∫squeda
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                if (searchTerm) {
                    filteredData = filteredData.filter(item => 
                        item.nombre.toLowerCase().includes(searchTerm) ||
                        item.id.toLowerCase().includes(searchTerm) ||
                        item.codigo_interno.toLowerCase().includes(searchTerm) ||
                        item.categoria.includes(searchTerm)
                    );
                }

                // Filtro por categor√≠a
                const categoryFilter = document.getElementById('filterCategory').value;
                if (categoryFilter) {
                    filteredData = filteredData.filter(item => item.categoria === categoryFilter);
                }

                // Filtro por stock
                const stockFilter = document.getElementById('filterStock').value;
                if (stockFilter) {
                    switch(stockFilter) {
                        case 'bajo':
                            filteredData = filteredData.filter(item => item.cantidad < 10);
                            break;
                        case 'medio':
                            filteredData = filteredData.filter(item => item.cantidad >= 10 && item.cantidad <= 50);
                            break;
                        case 'alto':
                            filteredData = filteredData.filter(item => item.cantidad > 50);
                            break;
                    }
                }

                this.renderInventory(filteredData);
            }

            viewProductDetails(productId) {
                const item = this.inventory.find(item => item.id === productId);
                if (item) {
                    document.getElementById('modalContent').innerHTML = `
                        <div style="text-align: center;">
                            <div class="product-image">
                                Imagen del producto
                            </div>
                            <div id="modalQR" style="width: 150px; height: 150px; margin: 0 auto 15px;"></div>
                            <h3>${item.nombre}</h3>
                            <p>ID: ${item.id}</p>
                            <p><strong>Descripci√≥n:</strong> ${item.descripcion || 'Sin descripci√≥n'}</p>
                            <p><strong>Categor√≠a:</strong> ${this.getCategoriaText(item.categoria)}</p>
                            <p><strong>Precio Unitario:</strong> $${item.precio.toFixed(2)}</p>
                            <p><strong>Cantidad:</strong> ${item.cantidad}</p>
                            <p><strong>Valor Total:</strong> $${(item.precio * item.cantidad).toFixed(2)}</p>
                            <p><strong>Estado:</strong> ${this.getEstadoText(item.estado)}</p>
                            <p><strong>Fecha Creaci√≥n:</strong> ${item.fecha_creacion}</p>
                            <div class="actions">
                                <button class="btn-info" onclick="app.downloadModalQR('${item.id}')">Descargar QR</button>
                            </div>
                        </div>
                    `;
                    document.getElementById('detailsModal').style.display = 'block';

                    // Generar QR en el modal
                    setTimeout(() => {
                        new QRCode(document.getElementById('modalQR'), {
                            text: JSON.stringify({
                                id: item.id,
                                nombre: item.nombre,
                                precio: item.precio,
                                cantidad: item.cantidad,
                                categoria: item.categoria,
                                estado: item.estado
                            }),
                            width: 150,
                            height: 150,
                            colorDark: "#000000",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                        });
                    }, 100);
                }
            }

            editProduct(productId) {
                const item = this.inventory.find(item => item.id === productId);
                if (item) {
                    document.getElementById('editId').value = item.id;
                    document.getElementById('nombre_producto').value = item.nombre;
                    document.getElementById('descripcion').value = item.descripcion || '';
                    document.getElementById('precio').value = item.precio;
                    document.getElementById('cantidad').value = item.cantidad;
                    document.getElementById('categoria').value = item.categoria;
                    document.getElementById('codigo_interno').value = item.codigo_interno || '';
                    document.getElementById('estado').value = item.estado;
                    document.getElementById('submitBtn').textContent = 'Actualizar Producto';
                    this.generateQRCode(item);
                    document.getElementById('productModal').style.display = 'block';
                }
            }

            deleteProduct(productId) {
                if (confirm(`¬øEst√° seguro de eliminar el producto ${productId}?`)) {
                    this.inventory = this.inventory.filter(item => item.id !== productId);
                    this.renderInventory();
                    this.updateStats();
                    this.showNotification(`Producto ${productId} eliminado correctamente`, 'success');
                }
            }

            handleProductFormSubmit(e) {
                e.preventDefault();
                const editId = document.getElementById('editId').value;
                const nombre = document.getElementById('nombre_producto').value;
                const descripcion = document.getElementById('descripcion').value;
                const precio = parseFloat(document.getElementById('precio').value);
                const cantidad = parseInt(document.getElementById('cantidad').value);
                const categoria = document.getElementById('categoria').value;
                const codigoInterno = document.getElementById('codigo_interno').value;
                const estado = document.getElementById('estado').value;

                const productData = {
                    nombre,
                    descripcion,
                    precio,
                    cantidad,
                    categoria,
                    codigo_interno: codigoInterno,
                    estado
                };

                if (editId) {
                    // Actualizar registro existente
                    const index = this.inventory.findIndex(item => item.id === editId);
                    if (index !== -1) {
                        this.inventory[index] = { ...this.inventory[index], ...productData };
                        this.showNotification(`Producto ${editId} actualizado exitosamente`, 'success');
                    }
                } else {
                    // Crear nuevo registro
                    const newItem = {
                        id: this.generateNewId(),
                        ...productData,
                        fecha_creacion: new Date().toISOString().split('T')[0]
                    };
                    this.inventory.push(newItem);
                    this.showNotification(`Nuevo producto registrado: ${newItem.id}`, 'success');
                }

                // Generar QR para el producto
                this.generateQRCode({...productData, id: editId || this.generateNewId()});

                // Limpiar formulario y actualizar tabla
                this.closeProductModal();
                this.renderInventory();
                this.updateStats();
            }

            closeProductModal() {
                document.getElementById('productForm').reset();
                document.getElementById('editId').value = '';
                document.getElementById('submitBtn').textContent = 'Registrar Producto QR';
                document.getElementById('qrDisplay').innerHTML = '<div style="color: #666;">QR Pendiente</div>';
                this.currentQRCode = null;
                document.getElementById('productModal').style.display = 'none';
            }

            generateQRCode(product) {
                // Eliminar instancia anterior si existe
                if (this.qrInstance) {
                    this.qrInstance.clear();
                    this.qrInstance.makeCode = null;
                }

                // Limpiar contenedor
                const qrDisplay = document.getElementById('qrDisplay');
                qrDisplay.innerHTML = '';

                // Crear nuevo c√≥digo QR
                this.qrInstance = new QRCode(qrDisplay, {
                    text: JSON.stringify({
                        id: product.id,
                        nombre: product.nombre,
                        precio: product.precio,
                        cantidad: product.cantidad,
                        categoria: product.categoria,
                        estado: product.estado
                    }),
                    width: 120,
                    height: 120,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });

                // Guardar datos actuales para descarga
                this.currentQRCode = product;
            }

            downloadQRCode() {
                if (!this.currentQRCode) {
                    this.showNotification('Primero genere un c√≥digo QR', 'error');
                    return;
                }

                // Crear un div temporal para generar el QR
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-1000px';
                document.body.appendChild(tempDiv);

                // Generar QR en el div temporal
                const tempQR = new QRCode(tempDiv, {
                    text: JSON.stringify({
                        id: this.currentQRCode.id,
                        nombre: this.currentQRCode.nombre,
                        precio: this.currentQRCode.precio,
                        cantidad: this.currentQRCode.cantidad,
                        categoria: this.currentQRCode.categoria,
                        estado: this.currentQRCode.estado
                    }),
                    width: 300,
                    height: 300,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });

                // Esperar a que se genere el QR
                setTimeout(() => {
                    // Convertir a imagen
                    const img = tempDiv.querySelector('img');
                    if (img) {
                        const link = document.createElement('a');
                        link.download = `qr_${this.currentQRCode.id}_${this.currentQRCode.nombre.replace(/\s+/g, '_')}.png`;
                        link.href = img.src;
                        link.click();
                    }

                    // Limpiar
                    document.body.removeChild(tempDiv);
                }, 100);
            }

            downloadModalQR(productId) {
                const item = this.inventory.find(item => item.id === productId);
                if (item) {
                    // Crear un div temporal para generar el QR
                    const tempDiv = document.createElement('div');
                    tempDiv.style.position = 'absolute';
                    tempDiv.style.left = '-1000px';
                    document.body.appendChild(tempDiv);

                    // Generar QR en el div temporal
                    const tempQR = new QRCode(tempDiv, {
                        text: JSON.stringify({
                            id: item.id,
                            nombre: item.nombre,
                            precio: item.precio,
                            cantidad: item.cantidad,
                            categoria: item.categoria,
                            estado: item.estado
                        }),
                        width: 300,
                        height: 300,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });

                    // Esperar a que se genere el QR
                    setTimeout(() => {
                        // Convertir a imagen
                        const img = tempDiv.querySelector('img');
                        if (img) {
                            const link = document.createElement('a');
                            link.download = `qr_${item.id}_${item.nombre.replace(/\s+/g, '_')}.png`;
                            link.href = img.src;
                            link.click();
                        }

                        // Limpiar
                        document.body.removeChild(tempDiv);
                    }, 100);
                }
            }

            updateStats() {
                document.getElementById('totalProducts').textContent = this.inventory.length;
                document.getElementById('scannedToday').textContent = this.scannedToday;
                this.updateReportStats();
            }

            updateReportStats() {
                document.getElementById('weeklyScans').textContent = this.inventory.length;
                document.getElementById('uniqueProducts').textContent = new Set(this.inventory.map(item => item.id)).size;
                let totalValue = 0;
                this.inventory.forEach(item => {
                    totalValue += item.precio * item.cantidad;
                });
                document.getElementById('totalValue').textContent = `$${totalValue.toFixed(2)}`;
            }

            refreshInventory() {
                this.renderInventory();
                this.showNotification('Inventario actualizado', 'info');
            }

            async exportPDF() {
                this.showNotification('Generando PDF del inventario...', 'info');
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    doc.setFontSize(20);
                    doc.text('Reporte de Inventario QRLOGIX', 20, 20);
                    doc.setFontSize(12);
                    doc.text(`Fecha: ${new Date().toLocaleString()}`, 20, 30);
                    doc.text(`Total Productos: ${this.inventory.length}`, 20, 40);
                    let y = 50;
                    this.inventory.slice(0, 20).forEach((item, index) => {
                        if (y > 280) {
                            doc.addPage();
                            y = 20;
                        }
                        doc.text(`${index + 1}. ${item.nombre} - ${item.cantidad} unidades - $${item.precio.toFixed(2)}`, 20, y);
                        y += 10;
                    });
                    doc.save('inventario_qrlogix.pdf');
                    this.showNotification('PDF generado y descargado', 'success');
                } catch (error) {
                    this.showNotification('Error generando PDF: ' + error.message, 'error');
                }
            }

            shareWhatsApp() {
                const message = `üì¶ *Inventario QRLOGIX*\n\nTotal productos: ${this.inventory.length}\nEscaneados hoy: ${this.scannedToday}\n\nQRLOGIX - Sistema Inteligente de Inventario`;
                const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            }

            generateWeeklyReport() {
                this.showNotification('Generando reporte semanal...', 'info');
                setTimeout(() => {
                    this.showNotification('Reporte semanal generado autom√°ticamente', 'success');
                }, 1500);
            }

            shareReportWhatsApp() {
                const message = `üìä *Reporte Semanal QRLOGIX*\n\nTotal productos: ${this.inventory.length}\nValor inventario: $${this.calculateTotalValue()}\nProductos √∫nicos: ${new Set(this.inventory.map(item => item.id)).size}\n\nGenerado autom√°ticamente por QRLOGIX AI`;
                const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            }

            calculateTotalValue() {
                let total = 0;
                this.inventory.forEach(item => {
                    total += item.precio * item.cantidad;
                });
                return total.toFixed(2);
            }

            startAutoReport() {
                this.reportInterval = setInterval(() => {
                    this.generateWeeklyReport();
                }, 7 * 24 * 60 * 60 * 1000); // Cada semana
            }

            showNotification(message, type) {
                this.notification.textContent = message;
                this.notification.className = `notification ${type} show`;
                setTimeout(() => {
                    this.notification.classList.remove('show');
                }, 3000);
            }

            destroy() {
                this.stopScanning();
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                }
                this.clearHighlights();
                if (this.reportInterval) {
                    clearInterval(this.reportInterval);
                }
            }
        }

        // Instancia global de la aplicaci√≥n
        let app;

        document.addEventListener('DOMContentLoaded', () => {
            app = new QRLOGIXSystem();

            window.addEventListener('beforeunload', () => {
                if (app) {
                    app.destroy();
                }
            });

            // Manejar orientaci√≥n del dispositivo
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    if (app && app.stream) {
                        app.canvas.width = app.video.videoWidth;
                        app.canvas.height = app.video.videoHeight;
                    }
                }, 500);
            });
        });
    </script>
</body>
</html>